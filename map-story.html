<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>Andrew + Adrienne</title>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
<script src='http://underscorejs.org/underscore-min.js'></script>
<script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.4/mapbox.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.4/mapbox.css' rel='stylesheet' />
<style>
  body { margin:0; padding:0; font-family: "Gill Sans Extrabold", Helvetica, sans-serif}
  #map { position:absolute; top:0; bottom:0; width:100%; }
  .markerimg {
    width: 250px;
    height: 250px;
    border-radius: 250px;
    background-color: white;
    opacity: 0.8;
  }
</style>
</head>
<body>
<style>
article {
  position:absolute;
  top:0;
  right:0;
  bottom:0px;
  left:0;
  overflow:auto;
  padding-bottom: 800px;
  }
.quiet {
  color:rgba(0,0,0,0.5);
  }
.scroll {
  display:block;
  text-align:center;
  }
.sections {
  background:rgba(255,255,255,0.5);
  width:240px;
  }
section {
  padding:20px;
  color:rgba(0,0,0,0.5);
  -webkit-transition:background 500ms, color 500ms;
          transition:background 500ms, color 500ms;
  }
section.active {
  background:#fff;
  color:#404040;
  }

@media (max-width:640px) {

    article {
        width:100%;
        min-width:100%;
        padding-top:0px;
        padding-bottom:200%;
    }
    .sections {
        width:100%;
        min-width:100%;
        padding-top:0px;
        padding-bottom:200%;
        background:none;
    }
    section {
        visibility: hidden;
    }
    section.active {
        visibility: visible;
    }

}
</style>
<div id='map'></div>

<article id='narrative'>
  <div class='sections prose'>
    <section id='cover' class='cover active'>
      <h2>The Adventures of the Andrew + Adrienne</h2>
      <small class='scroll quiet'>Scroll &#x25BE;</small>
    </section>
    <section id='sf'>
      <h3>San Francisco</h3>
      <p>They met in college. It was fun.</p>
    </section>
    <section id='kc'>
      <h3>Kansas City</h3>
      <p>He left for Kansas City.</p>
    </section>
    <section id='grandcanyon'>
      <h3>Grand Canyon</h3>
      <p>Was dope</p>
    </section>
    <section id='bigsur'>
      <h3>Big Sur</h3>
      <p>Right on</p>
    </section>
    <section id='la'>
      <h3>Los Angeles</h3>
      <p>Yep</p>
    </section>
    <section id='chicago'>
      <h3>Chicago</h3>
      <p>Holmes and Watson head to The Daily Telegraph and place an ad to draw out the criminal. It reads: "To-night. Same hour. Same place. Two taps. Most vitally important. Your own safety at stake. Pierrot." The trap works and Holmes catches the criminal: Colonel Valentine Walter, the brother of Woolwich Arsenal's chief. He confesses to working for Hugo Oberstein to obtain the submarine plans in order to pay off his debts.</p>
    </section>
    <section id='mexicocity'>
      <h3>Mexico City</h3>
      <p>Walter writes to Oberstein and convinces him to meet in the smoking room of the Charing Cross Hotel where he promises additional plans for the submarine in exchange for money. The plan works and Holmes and Watson catch both criminals.</p>
      <small class='colophon'>
        Adapted from <a href='http://www.gutenberg.org/files/2346/2346-h/2346-h.htm'>Project Gutenberg</a>
      </small>
    </section>
    <section id='nyc'>
      <h3>New York City</h3>
      <p>For sure </p>
    </section>
    <section id='yelapa'>
      <h3>Yelapa</h3>
      <p>dude</p>
    </section>
    <section id='mpls'>
      <h3>Minneapolis</h3>
      <p>Whatever</p>
    </section>
    <section id='moab'>
      <h3>Moab</h3>
      <p>yeakhjsd</p>
    </section>
    <section id='tokyo'>
      <h3>Tokyo</h3>
      <p>sdklfj</p>
    </section>
    <section id='you'>
      <h3>You</h3>
      <p>asdfsdafs</p>
    </section>
    <section id='vegas'>
      <h3>Vegas</h3>
      <p>Mycroft responds to Sherlock's telegram and mentions several spies. Hugo Oberstein of 13 Caulfield Gardens catches Sherlock's eye. He heads to the nearby Gloucester Road station to investigate and learns that the windows of Caulfield Gardens open over rail tracks where trains stop frequently.</p>
    </section>
  </div>
</article>

<script>
// In this case, we just hardcode data into the file. This could be dynamic.
// The important part about this data is that the 'id' property matches
// the HTML above - that's how we figure out how to link up the
// map and the data.
var places = [
    { "type" : "Feature",
    "geometry" : { "type": "Point", 
        "coordinates": [-122.419640, 37.777119] },
    "properties": { "id": "cover", "zoom": 2 }
    },
    { "type" : "Feature",
    "geometry" : { "type": "Point", 
        "coordinates": [-122.419640, 37.777119] },
    "properties": { "id": "sf", "zoom": 9,
        "icon" : { 
            "iconUrl" : "images/ades_bday.png",
            "className" : "markerimg"
             }
        }
    },
    { "type" : "Feature",
    "geometry": { "type": "Point",
        "coordinates": [-94.61915, 39.11325] },
    "properties": { "id": "kc", "zoom": 9,
        "icon" : { 
            "iconUrl" : "kcandrew.png",
            "className" : "markerimg",
            "iconSize" : [250, 250]
             }
        }
    },
    { "type" : "Feature",
    "geometry": { "type": "Point",
    "coordinates": [-112.716408, 36.195267] },
    "properties": { "id": "grandcanyon", "zoom": 9,
        "icon" : { 
            "iconUrl" : "gc.JPG",
            "className" : "markerimg",
            "iconSize" : [250, 250]
             }
        }
    },
    { "type" : "Feature",
    "geometry": { "type": "Point",
    "coordinates": [-121.811142, 36.272491] },
    "properties": { "id": "bigsur", "zoom": 9,
        "icon" : { 
            "iconUrl" : "bigsur.png",
            "className" : "markerimg",
            "iconSize" : [250, 250]
             }
        }
    },
    { "type" : "Feature",
    "geometry": { "type": "Point",
    "coordinates": [-118.245323, 34.053490] },
    "properties": { "id": "la", "zoom": 9,
        "icon" : { 
            "iconUrl" : "line.png",
            "className" : "markerimg",
            "iconSize" : [250, 250]
             }
        }
    },
    { "type" : "Feature",
    "geometry": { "type": "Point",
    "coordinates": [-93.264931, 44.979031] },
    "properties": { "id": "mpls", "zoom": 9,
        "icon" : { 
            "iconUrl" : "line.png",
            "className" : "markerimg",
            "iconSize" : [250, 250]
             }
        }
    },
    { "type" : "Feature",
    "geometry": { "type": "Point",
    "coordinates": [-115.139969, 36.171909] },
    "properties": { "id": "vegas", "zoom": 9 }
    },
]

L.mapbox.accessToken = 'pk.eyJ1IjoiY29kZWZvcmFtZXJpY2EiLCJhIjoiSTZlTTZTcyJ9.3aSlHLNzvsTwK-CYfZsG_Q';

var map = L.map('map',{
    center : [37.777119, -122.419640],
    zoom : 12,
    zoomControl: false
    });

var stamenLayer = L.tileLayer('http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg').addTo(map);

var placesLayer = L.mapbox.featureLayer(places);

placesLayer.eachLayer(function(place) {
      if (place.feature.properties.icon){
        place.setIcon(L.icon(place.feature.properties.icon));
      }
    });

// Ahead of time, select the elements we'll need -
// the narrative container and the individual sections
var narrative = document.getElementById('narrative'),
    sections = narrative.getElementsByTagName('section'),
    currentId = '';

setId('cover');

function setId(newId) {
    // If the ID hasn't actually changed, don't do anything
    if (newId === currentId) return;
    // Add the pictures to the map after the first scroll
    if (newId === "sf") placesLayer.addTo(map);
    // Otherwise, iterate through layers, zooming to the layer
    placesLayer.eachLayer(function(layer) {
        if (layer.feature.properties.id === newId) {
            map.setView(layer.getLatLng(), layer.feature.properties.zoom);
        }
    });
    // highlight the current section
    for (var i = 0; i < sections.length; i++) {
        sections[i].className = sections[i].id === newId ? 'active' : '';
    }
    // And then set the new id as the current one,
    // so that we know to do nothing at the beginning
    // of this function if it hasn't changed between calls
    currentId = newId;
}

narrative.onscroll = _(function(e) {
    var narrativeHeight = narrative.offsetHeight;
    var newId = currentId;
    // Find the section that's currently scrolled-to.
    // We iterate backwards here so that we find the topmost one.
    for (var i = sections.length - 1; i >= 0; i--) {
        var rect = sections[i].getBoundingClientRect();
        if (rect.top >= 0 && rect.top <= narrativeHeight) {
            newId = sections[i].id;
        }
    };
    setId(newId);
}).debounce(50);

</script>
</body>
</html>